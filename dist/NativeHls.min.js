module.exports=function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=5)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1),n=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=n.default},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),u=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},l=i(2),d=r(l),h=i(3),m=r(h),c=i(4),f=r(c),p=function(e){function t(e,i,r){n(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return o.manifestParsed=!1,o.audioMode=!1,o.metadata=[],o.previousMetadata=null,o.next=r,o.previousLevel=-1,o.lowestLevel=0,o.dvrThreshold=o.config.dvrThreshold,void 0===o.dvrThreshold&&(o.dvrThreshold=300),o.mediaDuration=0,o.endTime=0,o.beginTime=0,o.mediaSequence=0,o.lastMediaSequence=0,o.childManifest=null,o.qualityStreams=[],o.masterPlaylist=null,o.baseEndTime=0,o.manifestTimeoutId=null,o.pollResolutionId=null,o.currentResolution={width:0,height:0},o.name="nativeHLS",o.events=[],o}return o(t,e),a(t,[{key:"isItemSupported",value:function(e){var t=this;return new Promise(function(i){return"m3u8"!==e.type&&"m3u"!==e.type?i({supported:!1,errorCode:Meister.ErrorCodes.WRONG_TYPE}):t.meister.browser.isSafari&&(t.meister.browser.isiOS||!t.config.safariDesktopDisabled)||t.meister.browser.isFacebook||t.meister.browser.isiOS?e.drm||e.drmConfig?(t.meister.one("drmKeySystemSupport",function(e){var t=!1;return Object.keys(e).forEach(function(i){("com.apple.fps"===i&&e[i]||"com.apple.fps.1_0"===i&&e[i]||"com.apple.fps.2_0"===i&&e[i])&&(t=!0)}),i({supported:t,errorCode:t?null:Meister.ErrorCodes.NO_DRM})}),void t.meister.trigger("requestDrmKeySystemSupport",{})):i({supported:!0}):i({supported:!1,errorCode:Meister.ErrorCodes.NOT_SUPPORTED})})}},{key:"resetPrivates",value:function(){this.metadata=[],this.previousMetadata=null,this.manifestParsed=!1,this.previousLevel=-1,this.lowestLevel=0,this.mediaDuration=0,this.item=null}},{key:"process",value:function(e){var t=this;return this.next(e).then(function(e){return t.player=t.meister.getPlayerByType("html5",e),t.meister.config.audioOnly||"audio"===e.mediaType?t.audioMode=!0:t.audioMode=!1,e}).catch(function(e){console.error("Something went wrong while processing middlewares. "+e)})}},{key:"load",value:function(e){var i=this;return u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).call(this,e),this.item=e,new Promise(function(t){i.mediaElement=i.player.mediaElement,i.mediaElement.src=e.src,i.masterPlaylist=e.src,i.on("requestBitrate",i.onRequestBitrate.bind(i)),i.on("requestGoLive",function(){return i.onRequestGoLive()}),i.pollResolutionId=setInterval(i.pollResolution.bind(i),1e3),i.loadManifest(e.src).then(function(t){i.endTime=t.duration,i.baseEndTime=i.endTime,i.mediaDuration=t.duration,i.mediaSequence=t.mediaSequence,i.beginTime=i.endTime-i.mediaDuration;var r=Object.keys(t.segments)[Object.keys(t.segments).length-1];i.lastMediaSequence=r;var n=t.duration>i.dvrThreshold&&t.isLive;!1===i.config.dvrEnabled&&(n=!1),i.meister.trigger("itemTimeInfo",{isLive:t.isLive,hasDVR:n,duration:i.mediaDuration,modifiedDuration:i.mediaDuration,endTime:i.endTime}),e.startFromBeginning?isNaN(i.meister.duration)?i.meister.one("playerCanPlay",function(){i.meister.currentTime=0}):i.meister.currentTime=0:t.isLive&&i.onRequestGoLive(),i.manifestTimeoutId=setTimeout(function(){i.getNewManifest()},5e3)}),t()})}},{key:"_onPlayerTimeUpdate",value:function(){var e=this.endTime-this.mediaDuration;this.meister.trigger("playerTimeUpdate",{currentTime:this.player.currentTime-e,duration:this.mediaDuration}),this.broadcastTitle()}},{key:"_onPlayerSeek",value:function(){var e=this.endTime-this.mediaDuration,t=this.player.currentTime-e,i=this.mediaDuration,r=t/i;this.meister.trigger("playerSeek",{relativePosition:r,currentTime:t,duration:i})}},{key:"onRequestSeek",value:function(e){var t=void 0;if(Number.isFinite(e.relativePosition)){var i=this.endTime-this.mediaDuration;t=this.mediaDuration*e.relativePosition+i}else if(Number.isFinite(e.timeOffset))t=this.player.currentTime+e.timeOffset;else if(Number.isFinite(e.targetTime)){var r=this.endTime-this.mediaDuration;t=e.targetTime+r}!e.forcedStart&&this.blockSeekForward&&t>this.player.currentTime||Number.isFinite(t)&&(this.player.currentTime=t)}},{key:"onRequestGoLive",value:function(){var e=this;isNaN(this.player.duration)?this.meister.one("playerLoadedMetadata",function(){e.onRequestGoLive()}):this.player.currentTime=this.endTime-30}},{key:"broadcastTitle",value:function(){var e=this.player.currentTime;if(!(this.previousMetadata&&this.previousMetadata.start<e&&e<this.previousMetadata.end)){var t=this.currentlyPlaying;this.previousMetadata&&t.title===this.previousMetadata.title||(this.previousMetadata=t,this.meister.trigger("itemMetadata",{title:t.title}))}}},{key:"onRequestBitrate",value:function(e){var t=this,i=this.player.currentTime,r=this.meister.playing;e.drmConfig&&this.meister.trigger("drmConfig",e.drmConfig),this.meister.playerPlugin.mediaElement.src="",-1===e.bitrateIndex?this.meister.playerPlugin.mediaElement.src=this.masterPlaylist:this.meister.playerPlugin.mediaElement.src=this.meister.utils.resolveUrl(this.masterPlaylist,this.qualityStreams[e.bitrateIndex].url),this.playOffset=0,this.endTime=this.baseEndTime,this.meister.one("playerLoadedMetadata",function(){t.player.currentTime=i,r?t.meister.play():t.meister.pause()})}},{key:"onError",value:function(e,t){console.warn("Error in "+this.name+", type: "+t.details+", will attempt to recover."),t.fatal&&console.error("Can not recover from "+t.type+": "+t.details+".")}},{key:"pollResolution",value:function(){var e=this.mediaElement.videoHeight,t=this.mediaElement.videoWidth;if(this.currentResolution.width!==t||this.currentResolution.height!==e){var i=this.qualityStreams.find(function(i){return i.resolution&&i.resolution.width===t&&i.resolution.height===e});if(i){var r=this.qualityStreams.indexOf(i);this.meister.trigger("playerAutoSwitchBitrate",{newBitrate:parseInt(i.bandwith,10),newBitrateIndex:r}),this.currentResolution=i.resolution}}}},{key:"getNewManifest",value:function(){var e=this;this.loadManifest(this.childManifest).then(function(t){for(var i=Object.keys(t.segments)[Object.keys(t.segments).length-1],r=i-e.lastMediaSequence,n=0;n<r;n++)e.endTime+=t.segments[Object.keys(t.segments)[n]];e.mediaDuration=t.duration,e.beginTime=e.endTime-t.duration,e.lastMediaSequence=i;var s=t.duration>e.dvrThreshold&&t.isLive;!1===e.config.dvrEnabled&&(s=!1),e.meister.trigger("itemTimeInfo",{isLive:t.isLive,hasDVR:s,duration:e.mediaDuration,modifiedDuration:e.mediaDuration,endTime:e.endTime}),e.manifestTimeoutId=setTimeout(function(){e.getNewManifest()},5e3)},function(){console.warn("WARNING: Could not load manifest, retrying loading manifest."),e.manifestTimeoutId=setTimeout(function(){e.getNewManifest()},5e3)})}},{key:"loadManifest",value:function(e){var t=this;return new Promise(function(i){d.default.get(e,function(r){var n=new m.default(r.responseText),s=n.parse();s.streams.length?(t.config.filterAudioOnly?t.qualityStreams=s.streams.filter(function(e){return e.resolution}):t.qualityStreams=s.streams,t.onQualitysAvailable(),t.childManifest=t.meister.utils.resolveUrl(e,s.streams[0].url),t.loadManifest(t.meister.utils.resolveUrl(e,s.streams[0].url)).then(function(e){i(e)})):i(s)})})}},{key:"onQualitysAvailable",value:function(){var e=[];e.push({bitrate:0,index:-1});for(var t=0;t<this.qualityStreams.length;t++){var i=this.qualityStreams[t];e.push({bitrate:parseInt(i.bandwith,10),index:t})}this.meister.trigger("itemBitrates",{bitrates:e,currentIndex:-1})}},{key:"unload",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"unload",this).call(this),this.manifestTimeoutId&&clearTimeout(this.manifestTimeoutId),this.pollResolutionId&&clearInterval(this.pollResolutionId),this.meister.remove(this.events),this.mediaDuration=0,this.endTime=0,this.baseEndTime=0,this.beginTime=0,this.mediaSequence=0,this.lastMediaSequence=0,this.childManifest=null,this.qualityStreams=[],this.masterPlaylist=null,this.manifestTimeoutId=null,this.pollResolutionId=null,this.currentResolution={width:0,height:0},this.mediaElement=null}},{key:"destroy",value:function(){u(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"duration",get:function(){return this.mediaDuration}},{key:"currentTime",get:function(){if(!this.player)return NaN;var e=this.endTime-this.mediaDuration;return this.player.currentTime-e},set:function(e){if(this.player){var t=this.endTime-this.mediaDuration;this.player.currentTime=e+t}}},{key:"currentItem",get:function(){var e=this.currentlyPlaying;return{src:this.item.src,type:this.item.type,title:e.title,bitrate:e.bitrate}}},{key:"currentlyPlaying",get:function(){for(var e={bitrate:0,title:""},t=null,i=this.player.currentTime,r=this.metadata.length-1;r>=0;r--)if(this.metadata[r].start<i&&i<this.metadata[r].end){t=this.metadata[r];break}return t&&(e.title=t.title,e.start=t.start,e.end=t.end,e.duration=t.end-t.start),e}}],[{key:"pluginName",get:function(){return"NativeHls"}},{key:"pluginVersion",get:function(){return f.default.version}}]),t}(Meister.MediaPlugin);Meister.registerPlugin(p.pluginName,p),Meister.registerPlugin("nativehls",p),t.default=p},function(e,t,i){"use strict";function r(e,t){if(m(e)){this.instID=this.constructor.name+"."+Math.random()*(new Date).getTime();var i,n=e.method,s=e.url,u="",l="timeout"in e?e.timeout:3e3;if(this.timestamp=0,this.method=n,this.url=s,this.status=0,this.bytesDownloaded=0,this.totalSizeInBytes=0,this.downloadProgress=0,this.bandwidth=null,this.timeOfRequest=null,this.timeOfResponse=null,this.roundTripTime=null,this.onReady=null,this.onProgress=null,this.onLoadStart=null,this.onError=null,this.onSuccess=t,i=new XMLHttpRequest,"data"in e&&(u=c(e.data)),i.onreadystatechange=function(e){this.status=i.status,null!==this.onReady&&this.onReady()}.bind(this),i.onprogress=function(e){f.call(this,e),null!==this.onProgress&&this.onProgress()}.bind(this),i.onloadstart=function(e){this.timestamp=e.timeStamp,null!==this.onLoadStart&&this.onLoadStart()}.bind(this),i.onerror=function(e){r.downloadingRequests-=1,null!==this.onError?(this.onError||o)(i):this.onSuccess(null)}.bind(this),i.onload=function(e){f.call(this,e),r.downloadingRequests-=1;for(var t=0;t<a.length;t++){a[t].id==this.instID&&a.splice(t,1)}this.timeOfResponse=(new Date).getTime(),this.roundTripTime=this.timeOfResponse-this.timeOfRequest,i.bandwidth=Math.floor(this.bytesDownloaded/this.roundTripTime*8*1e3),this.bandwidth=i.bandwidth,this.onSuccess(i)}.bind(this),"GET"===n&&(s+=u),i.open(n,s,!0),this.timeOfRequest=(new Date).getTime(),r.downloadingRequests+=1,"responseType"in e&&(i.responseType=e.responseType),"headers"in e)for(var d in e.headers)e.headers.hasOwnProperty(d)&&(console.log("Setting header",d,"with",e.headers[d]),i.setRequestHeader(d,e.headers[d]));a.push({id:this.instID,inst:this});try{i.send(u)}catch(e){console.error("HTTP Request aborted due: ",e),(this.onError||o)(i)}this.timeout=setTimeout(function(){0===this.bytesDownloaded&&(this.abort(),null!==this.onError?this.onError(i):this.onSuccess(null)),clearTimeout(this.timeout)}.bind(this),l),this.xhr=i}}var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=0,o=function(){},a=[],u=0,l=[],d=[],h=function(e){var t=e;return"object"===(void 0===e?"undefined":n(e))&&null!==e&&function(){for(;;)if(null===Object.getPrototypeOf(t=Object.getPrototypeOf(t)))break;return Object.getPrototypeOf(e)===t}()},m=function(e){return h(e)?"method"in e?"url"in e||(console.error("Cannot construct http request, the url was not specified.",e),!1):(console.error("Cannot construct http request, the method was not specified.",e),!1):(console.error("Cannot construct http request, the options parameter is not an object literal.",e),!1)},c=function(e){var t=[];for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")},f=function(e){e.loaded<this.bytesDownloaded&&(this.bytesDownloaded=0);var t=e.loaded-this.bytesDownloaded,i=e.timeStamp-this.timestamp;s+=i,u+=t,r.totalBytesDownloaded+=t,this.bytesDownloaded=e.loaded,this.totalSizeInBytes=e.total,this.timestamp=e.timeStamp,this.downloadProgress=this.bytesDownloaded/this.totalSizeInBytes,r.resetStatistics()};r.downloadingRequests=0,r.totalBytesDownloaded=0,r.averagedBandwidth=0,r.get=function(e,t){return new r({url:e,method:"GET",data:{}},t)},r.post=function(e,t,i){return new r({url:e,method:"POST",data:t},i)},r.abortAll=function(){for(var e=0;e<a.length;e++){a[e].inst.abort()}},r.resetStatistics=function(){var e,t=0,i=0,n=null;for(s>0&&(d.push(s),s=0,d.length>7&&d.shift()),u>0&&(l.push(u),u=0,l.length>7&&l.shift()),e=0;e<d.length;e++)t+=d[e];for(e=0;e<l.length;e++)i+=l[e];t>0&&(n=1e3*i/t),r.averagedBandwidth=0===r.averagedBandwidth?n:(r.averagedBandwidth+n)/2,s=0,u=0},r.prototype.abort=function(){var e=this.xhr;e.onerror=null,e.abort(),r.downloadingRequests-=1},r.prototype.done=function(e){return this.onSuccess=e,this},r.prototype.error=function(e){return this.onError=e,this},r.prototype.progress=function(e){return this.onProgress=e,this},e.exports=r},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),s=function(){function e(t){r(this,e),this.text=t}return n(e,[{key:"parse",value:function(){var e=this.text.split("\n"),t={streams:[],segments:{},mediaSequence:0,duration:0,isLive:!0},i=!1,r=t.mediaSequence,n={};return e.forEach(function(e){i&&(n.url=e,t.streams.push(n),n={},i=!1),e.startsWith("#EXT-X-STREAM-INF")&&(i=!0),e.startsWith("#EXT-X-ENDLIST")&&(t.isLive=!1);var s=/^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d*)?/.exec(e);if(s&&s[1]){var o=s[1];n.bandwith=o}var a=/^#EXT-X-STREAM-INF:.*RESOLUTION=(\d*x\d*)?/.exec(e);if(a&&a[1]){var u=a[1].split("x");if(u.length<2)n.resolution={width:0,height:0};else{var l={width:parseInt(u[0],10),height:parseInt(u[1],10)};n.resolution=l}}var d=/^#EXTINF:?([0-9\.]*)?,?(.*)?/.exec(e);d&&d[1]&&(t.segments[r]=parseFloat(d[1]),r++,t.duration+=parseFloat(d[1]));var h=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e);h&&h[1]&&(t.mediaSequence=parseInt(h[1],10),r=parseInt(h[1],10))}),t}}]),e}();t.default=s},function(e,t){e.exports={name:"@meisterplayer/plugin-nativehls",version:"5.3.0",description:"Meister plugin for playback of HLS in browsers that support it natively (ex. Safari)",main:"dist/NativeHls.js",keywords:["meister","video","plugin","hls"],repository:{type:"git",url:"https://github.com/meisterplayer/media-nativehls.git"},author:"Triple",license:"Apache-2.0",dependencies:{},devDependencies:{"meister-gulp-webpack-tasks":"^1.0.6","meister-js-dev":"^3.1.0","babel-preset-es2015":"^6.24.0","babel-preset-es2017":"^6.22.0",gulp:"^3.9.1"},peerDependencies:{"@meisterplayer/meisterplayer":">= 5.1.0"}}},function(e,t,i){e.exports=i(0)}]);