module.exports=function(e){function t(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,t),n.l=!0,n.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,r){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=6)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(1),n=function(e){return e&&e.__esModule?e:{default:e}}(r);t.default=n.default},function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){function r(n,s){try{var a=t[n](s),o=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}return r("next")})}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),c=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,r)}if("value"in n)return n.value;var a=n.get;if(void 0!==a)return a.call(r)},d=i(3),m=r(d),h=i(5),f=r(h),p=i(4),y=r(p),v=i(2),g=r(v),b=function(e){function t(e,i,r){s(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return n.manifestParsed=!1,n.audioMode=!1,n.next=r,n.previousLevel=-1,n.lowestLevel=0,n.dvrThreshold=n.config.dvrThreshold,void 0===n.dvrThreshold&&(n.dvrThreshold=300),n.mediaDuration=0,n.endTime=0,n.beginTime=0,n.mediaSequence=0,n.lastMediaSequence=0,n.childManifest=null,n.qualityStreams=[],n.masterPlaylist=null,n.baseEndTime=0,n.manifestTimeoutId=null,n.pollResolutionId=null,n.currentResolution={width:0,height:0},n.name="nativeHLS",n.events=[],n}return o(t,e),l(t,[{key:"isItemSupported",value:function(e){var t=this;return new Promise(function(i){"m3u8"!==e.type&&"m3u"!==e.type&&i({supported:!1,errorCode:Meister.ErrorCodes.WRONG_TYPE}),(!t.meister.browser.isSafari||!t.meister.browser.isiOS&&t.config.safariDesktopDisabled)&&(t.meister.browser.isFacebook||t.meister.browser.isiOS||i({supported:!1,errorCode:Meister.ErrorCodes.NOT_SUPPORTED})),e.drm||e.drmConfig?(t.meister.one("drmKeySystemSupport",function(e){var t=!1;Object.keys(e).forEach(function(i){("com.apple.fps"===i&&e[i]||"com.apple.fps.1_0"===i&&e[i]||"com.apple.fps.2_0"===i&&e[i])&&(t=!0)}),i({supported:t,errorCode:t?null:Meister.ErrorCodes.NO_DRM})}),t.meister.trigger("requestDrmKeySystemSupport",{})):i({supported:!0})})}},{key:"resetPrivates",value:function(){this.previousMetadata=null,this.manifestParsed=!1,this.previousLevel=-1,this.lowestLevel=0,this.mediaDuration=0,this.item=null}},{key:"process",value:function(e){var t=this;return this.next(e).then(function(e){return t.player=t.meister.getPlayerByType("html5",e),t.meister.config.audioOnly||"audio"===e.mediaType?t.audioMode=!0:t.audioMode=!1,e}).catch(function(e){console.error("Something went wrong while processing middlewares. "+e)})}},{key:"load",value:function(){function e(e){return i.apply(this,arguments)}var i=n(regeneratorRuntime.mark(function e(i){var r,n,s,a,o,l=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"load",this).call(this,i),this.item=i,this.mediaElement=this.player.mediaElement,r=this.meister.playlist.list[this.meister.playlist.index],(0,y.default)(r)&&this.meister.browser.isMobile&&this.meister.browser.isSafari?this.one("GoogleIma:initialUserActionCompleted",function(){l.mediaElement.src=i.src}):this.mediaElement.src=i.src,this.masterPlaylist=i.src,this.on("requestBitrate",this.onRequestBitrate.bind(this)),this.on("requestGoLive",function(){return l.onRequestGoLive()}),this.mediaElement.textTracks.addEventListener("addtrack",this.onAddTextTrack.bind(this)),this.pollResolutionId=setInterval(this.pollResolution.bind(this),1e3),e.next=12,this.loadManifest(i.src);case 12:n=e.sent,n.keyInfo&&n.keyInfo.URI&&(s=n.keyInfo.URI.replace("skd:","https:"),this.meister.trigger("drmLicenseInfoAvailable",{fairplay:{drmServerUrl:s}})),this.endTime=n.duration,this.baseEndTime=this.endTime,this.mediaDuration=n.duration,this.mediaSequence=n.mediaSequence,this.beginTime=this.endTime-this.mediaDuration,a=Object.keys(n.segments)[Object.keys(n.segments).length-1],this.lastMediaSequence=a,o=n.duration>this.dvrThreshold&&n.isLive,!1===this.config.dvrEnabled&&(o=!1),this.meister.trigger("itemTimeInfo",{isLive:n.isLive,hasDVR:o,duration:this.mediaDuration,modifiedDuration:this.mediaDuration,endTime:this.endTime}),i.startFromBeginning?"object"===u(i.startFromBeginning)?this.onRequestSeek({relativePosition:i.startFromBeginning.offset/this.duration}):isNaN(this.meister.duration)?this.meister.one("playerCanPlay",function(){l.meister.currentTime=0}):this.meister.currentTime=0:n.isLive&&this.onRequestGoLive(),this.manifestTimeoutId=setTimeout(function(){l.getNewManifest()},5e3);case 26:case"end":return e.stop()}},e,this)}));return e}()},{key:"_onPlayerTimeUpdate",value:function(){var e=this.endTime-this.mediaDuration;this.meister.trigger("playerTimeUpdate",{currentTime:this.player.currentTime-e,duration:this.mediaDuration})}},{key:"_onPlayerSeek",value:function(){var e=this.endTime-this.mediaDuration,t=this.player.currentTime-e,i=this.mediaDuration,r=t/i;this.meister.trigger("playerSeek",{relativePosition:r,currentTime:t,duration:i})}},{key:"onRequestSeek",value:function(e){var t=void 0;if(Number.isFinite(e.relativePosition)){var i=this.endTime-this.mediaDuration;t=this.mediaDuration*e.relativePosition+i}else if(Number.isFinite(e.timeOffset))t=this.player.currentTime+e.timeOffset;else if(Number.isFinite(e.targetTime)){var r=this.endTime-this.mediaDuration;t=e.targetTime+r}!e.forcedStart&&this.blockSeekForward&&t>this.player.currentTime||Number.isFinite(t)&&(this.player.currentTime=t)}},{key:"onAddTextTrack",value:function(e){var t=this,i=e.track;i.mode="hidden",i.addEventListener("cuechange",function(e){var i=e.target,r=Array.from(i.activeCues).filter(function(e){return"org.id3"===e.type}),n=r.map(function(e){return new g.default(e.value.key,e.value.data,e.startTime,e.endTime)});t.meister.trigger("id3Tags",n)})}},{key:"onRequestGoLive",value:function(){var e=this;isNaN(this.player.duration)?this.meister.one("playerLoadedMetadata",function(){e.onRequestGoLive()}):this.player.currentTime=this.endTime-30}},{key:"onRequestBitrate",value:function(e){var t=this,i=this.player.currentTime,r=this.meister.playing;e.drmConfig&&this.meister.trigger("drmConfig",e.drmConfig),this.meister.playerPlugin.mediaElement.src="",-1===e.bitrateIndex?this.meister.playerPlugin.mediaElement.src=this.masterPlaylist:this.meister.playerPlugin.mediaElement.src=this.meister.utils.resolveUrl(this.masterPlaylist,this.qualityStreams[e.bitrateIndex].url),this.playOffset=0,this.endTime=this.baseEndTime,this.meister.one("playerLoadedMetadata",function(){t.player.currentTime=i,r?t.meister.play():t.meister.pause()})}},{key:"onError",value:function(e,t){console.warn("Error in "+this.name+", type: "+t.details+", will attempt to recover."),t.fatal&&console.error("Can not recover from "+t.type+": "+t.details+".")}},{key:"pollResolution",value:function(){var e=this.mediaElement.videoHeight,t=this.mediaElement.videoWidth;if(this.currentResolution.width!==t||this.currentResolution.height!==e){var i=this.qualityStreams.find(function(i){return i.resolution&&i.resolution.width===t&&i.resolution.height===e});if(i){var r=this.qualityStreams.indexOf(i);this.meister.trigger("playerAutoSwitchBitrate",{newBitrate:parseInt(i.bandwith,10),newBitrateIndex:r}),this.currentResolution=i.resolution}}}},{key:"getNewManifest",value:function(){function e(){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function e(){var t,i,r,n,s,a=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadManifest(this.childManifest);case 3:for(t=e.sent,i=Object.keys(t.segments)[Object.keys(t.segments).length-1],r=i-this.lastMediaSequence,n=0;n<r;n+=1)this.endTime+=t.segments[Object.keys(t.segments)[n]];this.mediaDuration=t.duration,this.beginTime=this.endTime-t.duration,this.lastMediaSequence=i,s=t.duration>this.dvrThreshold&&t.isLive,!1===this.config.dvrEnabled&&(s=!1),this.meister.trigger("itemTimeInfo",{isLive:t.isLive,hasDVR:s,duration:this.mediaDuration,modifiedDuration:this.mediaDuration,endTime:this.endTime}),this.manifestTimeoutId=setTimeout(function(){a.getNewManifest()},5e3),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),console.warn("WARNING: Could not load manifest, retrying loading manifest.",e.t0),this.manifestTimeoutId=setTimeout(function(){a.getNewManifest()},5e3);case 20:case"end":return e.stop()}},e,this,[[0,16]])}));return e}()},{key:"loadManifest",value:function(){function e(e){return t.apply(this,arguments)}var t=n(regeneratorRuntime.mark(function e(t){var i,r,n,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return i=e.sent,e.next=5,i.text();case 5:if(r=e.sent,n=new m.default(r),s=n.parse(),!s.streams.length){e.next=13;break}return this.config.filterAudioOnly?this.qualityStreams=s.streams.filter(function(e){return e.resolution}):this.qualityStreams=s.streams,this.onQualitysAvailable(),this.childManifest=this.meister.utils.resolveUrl(t,s.streams[0].url),e.abrupt("return",this.loadManifest(this.meister.utils.resolveUrl(t,s.streams[0].url)));case 13:return e.abrupt("return",s);case 14:case"end":return e.stop()}},e,this)}));return e}()},{key:"onQualitysAvailable",value:function(){var e=this.qualityStreams.map(function(e,t){return{bitrate:parseInt(e.bandwith,10),index:t}});e.unshift({bitrate:0,index:-1}),this.meister.trigger("itemBitrates",{bitrates:e,currentIndex:-1})}},{key:"unload",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"unload",this).call(this),this.manifestTimeoutId&&clearTimeout(this.manifestTimeoutId),this.pollResolutionId&&clearInterval(this.pollResolutionId),this.meister.remove(this.events),this.mediaDuration=0,this.endTime=0,this.baseEndTime=0,this.beginTime=0,this.mediaSequence=0,this.lastMediaSequence=0,this.childManifest=null,this.qualityStreams=[],this.masterPlaylist=null,this.manifestTimeoutId=null,this.pollResolutionId=null,this.currentResolution={width:0,height:0},this.mediaElement=null}},{key:"destroy",value:function(){c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"duration",get:function(){return this.mediaDuration}},{key:"currentTime",get:function(){if(!this.player)return NaN;var e=this.endTime-this.mediaDuration;return this.player.currentTime-e},set:function(e){if(this.player){var t=this.endTime-this.mediaDuration;this.player.currentTime=e+t}}}],[{key:"pluginName",get:function(){return"NativeHls"}},{key:"pluginVersion",get:function(){return f.default.version}}]),t}(Meister.MediaPlugin);Meister.registerPlugin(b.pluginName,b),Meister.registerPlugin("nativehls",b),t.default=b},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;r(this,e),this.data=i,this.key=t,this.type="org.id3",this.startTime=n,this.endTime=s};t.default=n},function(e,t,i){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){return e.replace("#EXT-X-KEY:","").split(",").reduce(function(e,t){var i=t.indexOf("="),r=t.substring(0,i),n=t.substring(i+1);return e[r]=n.replace(/"/g,""),e},{})}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),this.text=t}return s(e,[{key:"parse",value:function(){var e=this.text.split("\n"),t={streams:[],segments:{},mediaSequence:0,duration:0,isLive:!0},i=!1,r=t.mediaSequence,s={};return e.forEach(function(e){i&&(s.url=e,t.streams.push(s),s={},i=!1),e.startsWith("#EXT-X-STREAM-INF")&&(i=!0),e.startsWith("#EXT-X-ENDLIST")&&(t.isLive=!1),e.startsWith("#EXT-X-KEY")&&(t.keyInfo=n(e));var a=/^#EXT-X-STREAM-INF:.*BANDWIDTH=(\d*)?/.exec(e);if(a&&a[1]){var o=a[1];s.bandwith=o}var u=/^#EXT-X-STREAM-INF:.*RESOLUTION=(\d*x\d*)?/.exec(e);if(u&&u[1]){var l=u[1].split("x");if(l.length<2)s.resolution={width:0,height:0};else{var c={width:parseInt(l[0],10),height:parseInt(l[1],10)};s.resolution=c}}var d=/^#EXTINF:?([0-9.]*)?,?(.*)?/.exec(e);d&&d[1]&&(t.segments[r]=parseFloat(d[1]),r+=1,t.duration+=parseFloat(d[1]));var m=/^#EXT-X-MEDIA-SEQUENCE:?(-?[0-9.]*)?/.exec(e);m&&m[1]&&(t.mediaSequence=parseInt(m[1],10),r=parseInt(m[1],10))}),t}}]),e}();t.default=a},function(e,t,i){"use strict";function r(e){return!("media"!==e.type||!e.parallel)&&!!e.parallel.find(function(e){return"vmap"===e.type})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){e.exports={name:"@meisterplayer/plugin-nativehls",version:"5.6.1",description:"Meister plugin for playback of HLS in browsers that support it natively (ex. Safari)",main:"dist/NativeHls.js",keywords:["meister","video","plugin","hls"],repository:{type:"git",url:"https://github.com/meisterplayer/media-nativehls.git"},scripts:{lint:"eslint ./src/js",test:"jest","test:coverage":"jest --coverage",build:"gulp build",dist:"gulp build:min && gulp build:dist"},author:"Triple",license:"Apache-2.0",dependencies:{},devDependencies:{"@meisterplayer/meister-mock":"1.0.0","babel-preset-es2015":"6.24.0","babel-preset-es2017":"6.22.0",gulp:"3.9.1",jest:"20.0.4","meister-gulp-webpack-tasks":"1.0.6","meister-js-dev":"3.1.0"},peerDependencies:{"@meisterplayer/meisterplayer":">= 5.1.0"}}},function(e,t,i){e.exports=i(0)}]);